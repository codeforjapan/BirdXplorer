# AWS Lambda Container Image用のDockerfile (Topic Detection Lambda)
FROM public.ecr.aws/lambda/python:3.10

# 作業ディレクトリを設定
WORKDIR ${LAMBDA_TASK_ROOT}

RUN yum update -y && \
    yum install -y gcc gcc-c++ git && \
    yum clean all && \
    rm -rf /var/cache/yum

COPY etl/. .

RUN python -m pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -e .[prod]

# Lambda関数のコードをコピー
COPY etl/src/birdxplorer_etl/lib/lambda_handler/topic_detect_lambda.py ./

# Lambda関数のハンドラーを指定
CMD ["topic_detect_lambda.lambda_handler"]