FROM public.ecr.aws/lambda/python:3.12

# 作業ディレクトリを設定
WORKDIR ${LAMBDA_TASK_ROOT}

RUN dnf update -y && \
    dnf install -y gcc gcc-c++ git && \
    dnf clean all && \
    rm -rf /var/cache/dnf

COPY etl/. .

RUN python -m pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -e .[prod]

# Lambda関数のコードをコピー
COPY etl/src/birdxplorer_etl/lib/lambda_handler/language_detect_lambda.py ./

# Lambda関数のハンドラーを指定
CMD ["language_detect_lambda.lambda_handler"]